<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- DASHBOARD –ó –î–ï–†–ï–í–û–ú –°–¢–†–£–ö–¢–£–†–ò -->

    <!-- –ì–û–õ–û–í–ù–ò–ô DASHBOARD -->
    <record id="view_budget_tree_dashboard" model="ir.ui.view">
        <field name="name">budget.tree.dashboard</field>
        <field name="model">budget.responsibility.center</field>
        <field name="arch" type="xml">
            <form string="–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó —Ç–∞ –±—é–¥–∂–µ—Ç—ñ–≤">
                <sheet class="budget_tree_dashboard">
                    <!-- –ó–ê–ì–û–õ–û–í–û–ö DASHBOARD -->
                    <div class="oe_title">
                        <h1>–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó —Ç–∞ –±—é–¥–∂–µ—Ç—ñ–≤</h1>
                        <p class="text-muted">–Ü—î—Ä–∞—Ä—Ö—ñ—á–Ω–∏–π –≤–∏–≥–ª—è–¥ —è–∫ —É Windows Explorer</p>
                    </div>

                    <!-- –®–í–ò–î–ö–Ü –î–Ü–á -->
                    <div class="row dashboard-quick-actions mb-3">
                        <div class="col-md-3">
                            <button name="action_view_organization_tree" string="–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó"
                                    type="object" class="btn btn-primary btn-block"/>
                        </div>
                        <div class="col-md-3">
                            <button name="action_view_budget_tree" string="–î–µ—Ä–µ–≤–æ –±—é–¥–∂–µ—Ç—ñ–≤"
                                    type="object" class="btn btn-info btn-block"/>
                        </div>
                        <div class="col-md-3">
                            <button name="action_create_consolidation_wizard" string="–°—Ç–≤–æ—Ä–∏—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É"
                                    type="object" class="btn btn-success btn-block"/>
                        </div>
                        <div class="col-md-3">
                            <button name="action_budget_analysis" string="–ê–Ω–∞–ª—ñ—Ç–∏–∫–∞"
                                    type="object" class="btn btn-secondary btn-block"/>
                        </div>
                    </div>

                    <!-- –û–°–ù–û–í–ù–ò–ô –ö–û–ù–¢–ï–ù–¢ –£ 2 –ö–û–õ–û–ù–ö–ò -->
                    <div class="row">
                        <!-- –õ–Ü–í–ê –ö–û–õ–û–ù–ö–ê: –î–ï–†–ï–í–û –û–†–ì–ê–ù–Ü–ó–ê–¶–Ü–á -->
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5>–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó</h5>
                                    <div class="card-tools">
                                        <button name="action_refresh_org_tree" string="üîÑ"
                                                type="object" class="btn btn-sm btn-outline-secondary"
                                                title="–û–Ω–æ–≤–∏—Ç–∏ –¥–µ—Ä–µ–≤–æ"/>
                                        <button name="action_expand_all_org" string="‚¨áÔ∏è"
                                                type="object" class="btn btn-sm btn-outline-info"
                                                title="–†–æ–∑–≥–æ—Ä–Ω—É—Ç–∏ –≤—Å–µ"/>
                                    </div>
                                </div>
                                <div class="card-body p-0" style="max-height: 500px; overflow-y: auto;">
                                    <!-- –¢–£–¢ –ë–£–î–ï –î–ï–†–ï–í–û –û–†–ì–ê–ù–Ü–ó–ê–¶–Ü–á -->
                                    <field name="child_ids" widget="one2many_list"
                                           context="{'tree_view_ref': 'budget.view_responsibility_center_hierarchy_tree'}"
                                           options="{'no_create': True, 'no_edit': True}">
                                        <tree string="–û—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ–π–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞"
                                              decoration-bf="cbo_type in ['holding', 'enterprise']"
                                              expand="1">
                                            <field name="display_name_with_icon" string="–ù–∞–∑–≤–∞"/>
                                            <field name="budget_count" string="üìä"/>
                                            <field name="child_count" string="üè¢"/>
                                            <field name="responsible_user_id" widget="many2one_avatar_user"/>
                                            <button name="action_view_budgets" string="üìä" type="object"
                                                    class="btn-link" attrs="{'invisible': [('budget_count', '=', 0)]}"/>
                                            <button name="action_create_budget" string="‚ûï" type="object"
                                                    class="btn-link text-success"/>
                                        </tree>
                                    </field>
                                </div>
                            </div>
                        </div>

                        <!-- –ü–†–ê–í–ê –ö–û–õ–û–ù–ö–ê: –î–ï–†–ï–í–û –ë–Æ–î–ñ–ï–¢–Ü–í -->
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5>üí∞ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±—é–¥–∂–µ—Ç—ñ–≤</h5>
                                    <div class="card-tools">
                                        <button name="action_refresh_budget_tree" string="üîÑ"
                                                type="object" class="btn btn-sm btn-outline-secondary"
                                                title="–û–Ω–æ–≤–∏—Ç–∏ –¥–µ—Ä–µ–≤–æ"/>
                                        <button name="action_expand_all_budgets" string="‚¨áÔ∏è"
                                                type="object" class="btn btn-sm btn-outline-info"
                                                title="–†–æ–∑–≥–æ—Ä–Ω—É—Ç–∏ –≤—Å–µ"/>
                                    </div>
                                </div>
                                <div class="card-body p-0" style="max-height: 500px; overflow-y: auto;">
                                    <!-- –¢–£–¢ –ë–£–î–ï –î–ï–†–ï–í–û –ë–Æ–î–ñ–ï–¢–Ü–í -->
                                    <field name="budget_plan_ids" widget="one2many_list"
                                           context="{'tree_view_ref': 'budget.view_budget_plan_hierarchy_tree'}"
                                           options="{'no_create': True, 'no_edit': True}">
                                        <tree string="–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±—é–¥–∂–µ—Ç—ñ–≤"
                                              decoration-bf="is_consolidated == True"
                                              decoration-info="consolidation_level == 'holding'"
                                              expand="1">
                                            <field name="tree_display_name" string="–ë—é–¥–∂–µ—Ç"/>
                                            <field name="period_id" string="–ü–µ—Ä—ñ–æ–¥"/>
                                            <field name="total_planned_amount" string="üí∞ –°—É–º–∞" widget="monetary"/>
                                            <field name="state" string="–°—Ç–∞—Ç—É—Å" widget="badge"/>
                                            <field name="execution_percentage" string="%" widget="progressbar"/>
                                            <button name="action_view_lines" string="üìã" type="object" class="btn-link"/>
                                            <button name="action_consolidate_up" string="‚¨ÜÔ∏è" type="object"
                                                    class="btn-link text-info"
                                                    attrs="{'invisible': [('parent_budget_id', '=', False)]}"/>
                                        </tree>
                                    </field>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ó–ù–ò–ó–£ -->
                    <div class="row mt-4">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5>–ó–∞–≥–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row text-center">
                                        <div class="col-md-3">
                                            <div class="statistic-box">
                                                <div class="stat-icon">üè¢</div>
                                                <div class="stat-number" id="total_cbos">-</div>
                                                <div class="stat-label">–í—Å—å–æ–≥–æ –¶–ë–û</div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="statistic-box">
                                                <div class="stat-icon">üí∞</div>
                                                <div class="stat-number" id="total_budgets">-</div>
                                                <div class="stat-label">–í—Å—å–æ–≥–æ –±—é–¥–∂–µ—Ç—ñ–≤</div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="statistic-box">
                                                <div class="stat-icon">‚úÖ</div>
                                                <div class="stat-number" id="approved_budgets">-</div>
                                                <div class="stat-label">–ó–∞—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ</div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="statistic-box">
                                                <div class="stat-icon">üéØ</div>
                                                <div class="stat-number" id="avg_execution">-</div>
                                                <div class="stat-label">–°–µ—Ä–µ–¥–Ω—î –≤–∏–∫–æ–Ω–∞–Ω–Ω—è</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- –Ü–ù–¢–ï–†–ê–ö–¢–ò–í–ù–ò–ô –ö–û–ú–ü–û–ù–ï–ù–¢ –î–ï–†–ï–í–ê (JS) -->
                    <div class="row mt-4">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5>–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–µ –¥–µ—Ä–µ–≤–æ</h5>
                                </div>
                                <div class="card-body">
                                    <!-- –¢–£–¢ –ë–£–î–ï JS –ö–û–ú–ü–û–ù–ï–ù–¢ -->
                                    <div id="interactive_tree_container"
                                         class="hierarchy-tree-widget"
                                         style="min-height: 400px;">
                                        <div class="loading-placeholder">
                                            <i class="fa fa-spinner fa-spin"></i> –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –¥–µ—Ä–µ–≤–∞...
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </sheet>
            </form>
        </field>
    </record>

    <!-- KANBAN VIEW –î–õ–Ø –®–í–ò–î–ö–û–ì–û –î–û–°–¢–£–ü–£ -->
    <record id="view_tree_dashboard_kanban" model="ir.ui.view">
        <field name="name">budget.tree.dashboard.kanban</field>
        <field name="model">budget.responsibility.center</field>
        <field name="arch" type="xml">
            <kanban class="tree_dashboard_kanban" default_group_by="cbo_type">
                <field name="name"/>
                <field name="cbo_type"/>
                <field name="budget_count"/>
                <field name="child_count"/>
                <field name="total_budget_amount"/>
                <field name="responsible_user_id"/>

                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_card tree-dashboard-card">
                            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–∞—Ä—Ç–∫–∏ -->
                            <div class="oe_kanban_header">
                                <div class="oe_kanban_header_left">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <t t-if="record.cbo_type.raw_value == 'holding'">üèõÔ∏è</t>
                                            <t t-elif="record.cbo_type.raw_value == 'enterprise'">üè≠</t>
                                            <t t-elif="record.cbo_type.raw_value == 'department'">üè™</t>
                                            <t t-else="">üìÇ</t>
                                            <field name="name"/>
                                        </strong>
                                        <span class="o_kanban_record_subtitle">
                                            <field name="cbo_type"/>
                                        </span>
                                    </div>
                                </div>
                                <div class="oe_kanban_header_right">
                                    <field name="responsible_user_id" widget="many2one_avatar_user"/>
                                </div>
                            </div>

                            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –∫–∞—Ä—Ç–∫–∏ -->
                            <div class="oe_kanban_content">
                                <div class="row">
                                    <div class="col-6">
                                        <div class="kanban-stat">
                                            <span class="kanban-stat-value"><field name="budget_count"/></span>
                                            <span class="kanban-stat-label">–ë—é–¥–∂–µ—Ç—ñ–≤</span>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="kanban-stat">
                                            <span class="kanban-stat-value"><field name="child_count"/></span>
                                            <span class="kanban-stat-label">–ü—ñ–¥—Ä–æ–∑–¥—ñ–ª—ñ–≤</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="kanban-amount mt-2">
                                    <strong>üí∞ <field name="total_budget_amount" widget="monetary"/></strong>
                                </div>
                            </div>

                            <!-- –î—ñ—ó –∫–∞—Ä—Ç–∫–∏ -->
                            <div class="oe_kanban_footer">
                                <div class="oe_kanban_footer_left">
                                    <button name="action_view_organization_tree" string="–î–µ—Ä–µ–≤–æ"
                                            type="object" class="btn btn-sm btn-outline-primary"/>
                                </div>
                                <div class="oe_kanban_footer_right">
                                    <button name="action_view_budgets" string="–ë—é–¥–∂–µ—Ç–∏"
                                            type="object" class="btn btn-sm btn-outline-info"
                                            t-if="record.budget_count.raw_value > 0"/>
                                    <button name="action_create_budget" string="‚ûï"
                                            type="object" class="btn btn-sm btn-outline-success"
                                            title="–°—Ç–≤–æ—Ä–∏—Ç–∏ –±—é–¥–∂–µ—Ç"/>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- –î–Ü–á –î–õ–Ø DASHBOARD -->
    <record id="action_budget_tree_dashboard" model="ir.actions.act_window">
        <field name="name">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó —Ç–∞ –±—é–¥–∂–µ—Ç—ñ–≤</field>
        <field name="res_model">budget.responsibility.center</field>
        <field name="view_mode">form,kanban,tree</field>
        <field name="view_ids" eval="[(5, 0, 0),
            (0, 0, {'view_mode': 'form', 'view_id': ref('view_budget_tree_dashboard')}),
            (0, 0, {'view_mode': 'kanban', 'view_id': ref('view_tree_dashboard_kanban')}),
            (0, 0, {'view_mode': 'tree', 'view_id': ref('view_responsibility_center_hierarchy_tree')})]"/>
        <field name="target">current</field>
        <field name="domain">[('parent_id', '=', False)]</field>
        <field name="context">{
            'dashboard_mode': True,
            'expand_tree': True
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                –ü–µ—Ä–µ–≥–ª—è–¥ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ —è–∫ —É Windows Explorer!
            </p>
            <p>
                –Ü—î—Ä–∞—Ä—Ö—ñ—á–Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó —Ç–∞ –±—é–¥–∂–µ—Ç—ñ–≤ –∑ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—é —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è/–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –≥—ñ–ª–æ–∫ –¥–µ—Ä–µ–≤–∞.
            </p>
        </field>
    </record>

    <!-- –û–ö–†–ï–ú–ò–ô DASHBOARD –î–õ–Ø –ë–Æ–î–ñ–ï–¢–Ü–í -->
    <record id="action_budget_hierarchy_dashboard" model="ir.actions.act_window">
        <field name="name">–Ü—î—Ä–∞—Ä—Ö—ñ—è –±—é–¥–∂–µ—Ç—ñ–≤</field>
        <field name="res_model">budget.plan</field>
        <field name="view_mode">tree,form</field>
        <field name="view_id" ref="view_budget_plan_hierarchy_tree"/>
        <field name="context">{
            'group_by': ['consolidation_level', 'cbo_id'],
            'expand': True,
            'hierarchy_dashboard': True
        }</field>
    </record>

</odoo>