<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- –ö–û–ú–ü–ê–ö–¢–ù–Ü –ü–†–ï–î–°–¢–ê–í–õ–ï–ù–ù–Ø –î–õ–Ø –†–û–ë–û–¢–ò –ó –ë–Æ–î–ñ–ï–¢–ê–ú–ò -->

    <!-- –ö–û–ú–ü–ê–ö–¢–ù–ê –§–û–†–ú–ê –ë–Æ–î–ñ–ï–¢–£ - –ú–Ü–ù–Ü–ú–ê–õ–¨–ù–ê –®–ê–ü–ö–ê -->
    <record id="view_budget_plan_compact_form" model="ir.ui.view">
        <field name="name">budget.plan.compact.form</field>
        <field name="model">budget.plan</field>
        <field name="priority">20</field>
        <field name="arch" type="xml">
            <form>
                <!-- –ú–Ü–ù–Ü–ú–ê–õ–¨–ù–ê –®–ê–ü–ö–ê –í –û–î–ù–£ –õ–Ü–ù–Ü–Æ -->
                <header>
                    <button name="action_submit_for_approval" string="–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –Ω–∞ –∑–∞—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è"
                            type="object" states="draft,planning" class="btn-primary"/>
                    <button name="action_approve" string="–ó–∞—Ç–≤–µ—Ä–¥–∏—Ç–∏"
                            type="object" states="review" class="btn-success"
                            groups="budget.group_budget_manager"/>
                    <button name="action_copy_from_previous_period" string="üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏ –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –ø–µ—Ä—ñ–æ–¥—É"
                            type="object" states="draft,planning" class="btn-secondary"/>
                    <field name="state" widget="statusbar"/>
                </header>

                <sheet>
                    <!-- –ö–û–ú–ü–ê–ö–¢–ù–ê –®–ê–ü–ö–ê –£ 2 –†–Ø–î–ö–ò -->
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="–ù–∞–∑–≤–∞ –±—é–¥–∂–µ—Ç—É..."/>
                        </h1>
                    </div>

                    <!-- –ë–ê–ó–û–í–Ü –ü–û–õ–Ø –í 1 –†–Ø–î–û–ö -->
                    <group col="6" class="o_group_compact">
                        <field name="period_id" options="{'no_create': True}"/>
                        <field name="budget_type_id" options="{'no_create': True}"/>
                        <field name="cbo_id" options="{'no_create': True}"/>
                        <field name="responsible_user_id"/>
                        <field name="consolidation_level" readonly="1"/>
                        <field name="is_consolidated" readonly="1"/>
                    </group>

                    <!-- –®–í–ò–î–ö–Ü –î–Ü–á -->
                    <div class="alert alert-info" style="margin: 10px 0;">
                        <div class="row">
                            <div class="col-md-3">
                                <button name="action_copy_from_previous_period"
                                        string="üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏ –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ"
                                        type="object" class="btn btn-sm btn-outline-primary w-100"/>
                            </div>
                            <div class="col-md-3">
                                <button name="action_consolidate_up"
                                        string="‚¨ÜÔ∏è –ö–æ–Ω—Å–æ–ª—ñ–¥—É–≤–∞—Ç–∏ –≤–≥–æ—Ä—É"
                                        type="object" class="btn btn-sm btn-outline-info w-100"
                                        attrs="{'invisible': [('parent_budget_id', '=', False)]}"/>
                            </div>
                            <div class="col-md-3">
                                <button name="action_view_consolidated_structure"
                                        string="üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω—Å–æ–ª—ñ–¥–∞—Ü—ñ—ó"
                                        type="object" class="btn btn-sm btn-outline-secondary w-100"/>
                            </div>
                            <div class="col-md-3">
                                <field name="auto_consolidate" widget="boolean_toggle"/>
                                <label for="auto_consolidate" string="–ê–≤—Ç–æ–∫–æ–Ω—Å–æ–ª—ñ–¥–∞—Ü—ñ—è"/>
                            </div>
                        </div>
                    </div>

                    <!-- –û–°–ù–û–í–ù–ò–ô –ü–†–û–°–¢–Ü–† –î–õ–Ø –î–ê–ù–ò–• -->
                    <notebook>
                        <page string="üí∞ –ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è –±—é–¥–∂–µ—Ç—É" name="budget_lines">
                            <!-- –®–í–ò–î–ö–Ü –§–Ü–õ–¨–¢–†–ò –ù–ê–î –¢–ê–ë–õ–ò–¶–ï–Æ -->
                            <div class="row mb-2">
                                <div class="col-md-8">
                                    <div class="btn-group" role="group">
                                        <button type="button" class="btn btn-sm btn-outline-secondary"
                                                onclick="document.querySelector('.o_field_x2many_list_row_add a').click()">
                                            ‚ûï –î–æ–¥–∞—Ç–∏ –ª—ñ–Ω—ñ—é
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-info"
                                                onclick="this.closest('form').querySelector('[data-field=line_ids] .o_list_view').classList.toggle('compact-mode')">
                                            üìä –ö–æ–º–ø–∞–∫—Ç–Ω–∏–π —Ä–µ–∂–∏–º
                                        </button>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <span class="badge badge-info float-right">
                                        –ó–∞–≥–∞–ª–æ–º: <field name="total_planned_amount" readonly="1"/>
                                    </span>
                                </div>
                            </div>

                            <!-- –¢–ê–ë–õ–ò–¶–Ø –õ–Ü–ù–Ü–ô –ë–Æ–î–ñ–ï–¢–£ -->
                            <field name="line_ids"
                                   widget="one2many_list"
                                   mode="tree"
                                   context="{'tree_view_ref': 'budget.view_budget_line_compact_tree', 'form_view_ref': 'budget.view_budget_line_quick_form'}">

                                <!-- –í–ë–£–î–û–í–ê–ù–ê –ö–û–ú–ü–ê–ö–¢–ù–ê –¢–ê–ë–õ–ò–¶–Ø -->
                                <tree editable="bottom" decoration-info="is_consolidation" class="table-sm">
                                    <!-- –û–°–ù–û–í–ù–Ü –ü–û–õ–Ø –í –ö–û–ú–ü–ê–ö–¢–ù–û–ú–£ –í–ò–ì–õ–Ø–î–Ü -->
                                    <field name="budget_category_id" string="–ö–∞—Ç–µ–≥–æ—Ä—ñ—è"
                                           width="200px" options="{'no_create': True}"/>
                                    <field name="description" string="–û–ø–∏—Å" width="300px"/>
                                    <field name="quantity" string="–ö-—Ç—å" width="70px"/>
                                    <field name="unit_price" string="–¶—ñ–Ω–∞" width="100px"/>
                                    <field name="planned_amount" string="üí∞ –°—É–º–∞" width="120px" sum="–†–∞–∑–æ–º"/>

                                    <!-- –î–û–î–ê–¢–ö–û–í–Ü –ü–û–õ–Ø (–ú–û–ñ–ù–ê –°–•–û–í–ê–¢–ò) -->
                                    <field name="cost_center_id" string="–¶–í" width="120px" optional="hide"
                                           options="{'no_create': True}"/>
                                    <field name="actual_amount" string="‚úÖ –§–∞–∫—Ç" width="100px" optional="hide"/>
                                    <field name="account_id" string="–†–∞—Ö—É–Ω–æ–∫" width="100px" optional="hide"
                                           groups="account.group_account_user" readonly="1"/>

                                    <!-- –°–õ–£–ñ–ë–û–í–Ü –ü–û–õ–Ø -->
                                    <field name="is_consolidation" invisible="1"/>
                                </tree>
                            </field>
                        </page>

                        <!-- –î–û–î–ê–¢–ö–û–í–Ü –í–ö–õ–ê–î–ö–ò –ó–ì–û–†–ù–£–¢–Ü –î–û –ú–Ü–ù–Ü–ú–£–ú–£ -->
                        <page string="üìä –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞" name="analytics" attrs="{'invisible': [('state', 'in', ['draft', 'planning'])]}">
                            <group>
                                <group string="–í–∏–∫–æ–Ω–∞–Ω–Ω—è –±—é–¥–∂–µ—Ç—É">
                                    <field name="total_planned_amount" readonly="1"/>
                                    <field name="total_committed_amount" readonly="1"/>
                                    <field name="total_actual_amount" readonly="1"/>
                                </group>
                                <group string="–í—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è">
                                    <field name="variance_amount" readonly="1"/>
                                    <field name="variance_percentage" readonly="1"/>
                                    <field name="execution_percentage" readonly="1"/>
                                </group>
                            </group>
                        </page>

                        <page string="üèóÔ∏è –ö–æ–Ω—Å–æ–ª—ñ–¥–∞—Ü—ñ—è" name="consolidation"
                              attrs="{'invisible': [('consolidation_level', '=', 'site')]}">
                            <group>
                                <group string="–°—Ç—Ä—É–∫—Ç—É—Ä–∞">
                                    <field name="parent_budget_id" readonly="1"/>
                                    <field name="child_budget_ids" readonly="1" widget="many2many_tags"/>
                                </group>
                                <group string="–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è">
                                    <field name="auto_consolidate"/>
                                    <button name="action_consolidate_up" string="–ö–æ–Ω—Å–æ–ª—ñ–¥—É–≤–∞—Ç–∏ –∑–∞—Ä–∞–∑"
                                            type="object" class="btn-info"/>
                                </group>
                            </group>
                        </page>

                        <page string="üìù –ü—Ä–∏–º—ñ—Ç–∫–∏" name="notes">
                            <field name="notes" placeholder="–î–æ–¥–∞—Ç–∫–æ–≤—ñ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ –¥–æ –±—é–¥–∂–µ—Ç—É..."/>
                        </page>
                    </notebook>
                </sheet>

                <!-- –ß–ê–¢–ï–† -->
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <!-- –®–í–ò–î–ö–ê –§–û–†–ú–ê –î–õ–Ø –†–ï–î–ê–ì–£–í–ê–ù–ù–Ø –õ–Ü–ù–Ü–á -->
    <record id="view_budget_line_quick_form" model="ir.ui.view">
        <field name="name">budget.plan.line.quick.form</field>
        <field name="model">budget.plan.line</field>
        <field name="priority">25</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <group col="4">
                        <field name="budget_category_id" colspan="2"/>
                        <field name="cost_center_id" colspan="2"/>
                        <field name="description" colspan="4"/>
                        <field name="quantity"/>
                        <field name="unit_price"/>
                        <field name="planned_amount" readonly="1"/>
                        <field name="calculation_method"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- –ú–ê–°–û–í–ò–ô –†–ï–î–ê–ö–¢–û–† –ë–Æ–î–ñ–ï–¢–ù–ò–• –õ–Ü–ù–Ü–ô -->
    <record id="view_budget_lines_mass_edit" model="ir.ui.view">
        <field name="name">budget.lines.mass.edit</field>
        <field name="model">budget.plan.line</field>
        <field name="priority">30</field>
        <field name="arch" type="xml">
            <tree editable="top" multi_edit="1" class="table-sm">
                <field name="plan_id" readonly="1"/>
                <field name="budget_category_id" options="{'no_create': True}"/>
                <field name="cost_center_id" options="{'no_create': True}"/>
                <field name="description"/>
                <field name="quantity"/>
                <field name="unit_price"/>
                <field name="planned_amount"/>
                <field name="notes"/>
            </tree>
        </field>
    </record>

    <!-- –î–Ü–Ø –î–õ–Ø –ö–û–ú–ü–ê–ö–¢–ù–û–ì–û –†–ï–ñ–ò–ú–£ -->
    <record id="action_budget_plan_compact" model="ir.actions.act_window">
        <field name="name">üè¢ –ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è –±—é–¥–∂–µ—Ç—ñ–≤ (–∫–æ–º–ø–∞–∫—Ç–Ω–æ)</field>
        <field name="res_model">budget.plan</field>
        <field name="view_mode">tree,form</field>
        <field name="view_ids" eval="[(5, 0, 0),
            (0, 0, {'view_mode': 'tree', 'view_id': ref('budget.view_budget_plan_tree')}),
            (0, 0, {'view_mode': 'form', 'view_id': ref('view_budget_plan_compact_form')})]"/>
        <field name="domain">[('is_consolidated', '=', False)]</field>
        <field name="context">{
            'default_state': 'draft',
            'search_default_my_budgets': 1
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                –°—Ç–≤–æ—Ä—ñ—Ç—å –≤–∞—à –ø–µ—Ä—à–∏–π –±—é–¥–∂–µ—Ç!
            </p>
            <p>
                –ö–æ–º–ø–∞–∫—Ç–Ω–∏–π —Ä–µ–∂–∏–º –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è –±—é–¥–∂–µ—Ç—ñ–≤.<br/>
                –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ —à–∞–ø–∫–∞, –º–∞–∫—Å–∏–º—É–º –º—ñ—Å—Ü—è –¥–ª—è –¥–∞–Ω–∏—Ö.
            </p>
        </field>
    </record>

    <!-- –î–Ü–Ø –î–õ–Ø –ú–ê–°–û–í–û–ì–û –†–ï–î–ê–ì–£–í–ê–ù–ù–Ø –õ–Ü–ù–Ü–ô -->
    <record id="action_budget_lines_mass_edit" model="ir.actions.act_window">
        <field name="name">‚úèÔ∏è –ú–∞—Å–æ–≤–µ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –ª—ñ–Ω—ñ–π</field>
        <field name="res_model">budget.plan.line</field>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="view_budget_lines_mass_edit"/>
        <field name="target">current</field>
    </record>

</odoo>