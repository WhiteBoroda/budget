<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- views/bdr_budget_wizard_enhanced_views.xml -->

    <!-- –§–æ—Ä–º–∞ –ø–æ–∫—Ä–∞—â–µ–Ω–æ–≥–æ –º–∞–π—Å—Ç—Ä–∞ –ë–î–† -->
    <record id="view_bdr_budget_wizard_enhanced_form" model="ir.ui.view">
        <field name="name">bdr.budget.wizard.enhanced.form</field>
        <field name="model">bdr.budget.wizard.enhanced</field>
        <field name="arch" type="xml">
            <form string="–ü–æ–∫—Ä–∞—â–µ–Ω–∏–π –º–∞–π—Å—Ç–µ—Ä –ë–î–†">

                <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
                <div class="alert alert-info" invisible="context.get('show_result', False)">
                    <h4>üèóÔ∏è –ü–æ–∫—Ä–∞—â–µ–Ω–∏–π –º–∞–π—Å—Ç–µ—Ä —Ä–æ–±–æ—Ç–∏ –∑ –ë–î–†</h4>
                    <p>–Ü–º–ø–æ—Ä—Ç —Ç–∞ –µ–∫—Å–ø–æ—Ä—Ç –±—é–¥–∂–µ—Ç—ñ–≤ –¥–æ—Ö–æ–¥—ñ–≤ —ñ –≤–∏—Ç—Ä–∞—Ç –∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–º —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è–º –∫–∞—Ç–µ–≥–æ—Ä—ñ–π</p>
                </div>

                <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø–µ—Ä–∞—Ü—ñ—ó -->
                <div class="alert alert-success" invisible="not context.get('show_result', False)">
                    <h4>‚úÖ –û–ø–µ—Ä–∞—Ü—ñ—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø—ñ—à–Ω–æ!</h4>
                    <field name="import_summary" readonly="1" nolabel="1"/>
                </div>

                <!-- –û—Å–Ω–æ–≤–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è -->
                <group invisible="context.get('show_result', False)">
                    <group string="–¢–∏–ø –æ–ø–µ—Ä–∞—Ü—ñ—ó">
                        <field name="operation_type" widget="radio"/>
                    </group>
                </group>

                <!-- –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –±—é–¥–∂–µ—Ç—É -->
                <group invisible="context.get('show_result', False)">
                    <group string="–ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –±—é–¥–∂–µ—Ç—É">
                        <field name="period_id" options="{'no_create': True}" required="1"/>
                        <field name="company_id" options="{'no_create': True}" required="1"/>
                        <field name="cbo_id" options="{'no_create': True}" required="1"/>
                    </group>
                    <group string="–†–µ–∂–∏–º —Ä–æ–±–æ—Ç–∏ –∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º–∏" invisible="operation_type == 'export'">
                        <field name="use_categories"/>
                        <field name="auto_create_categories" invisible="not use_categories"/>
                        <field name="import_categories_only" invisible="not use_categories"/>
                    </group>
                </group>

                <!-- –Ü–º–ø–æ—Ä—Ç —Ñ–∞–π–ª—É -->
                <group invisible="operation_type not in ['import', 'import_categories'] or context.get('show_result', False)">
                    <group string="–§–∞–π–ª –¥–ª—è —ñ–º–ø–æ—Ä—Ç—É">
                        <field name="import_file" widget="binary" filename="filename" required="operation_type in ['import', 'import_categories']"/>
                        <field name="filename" invisible="1"/>
                    </group>
                    <group string="–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Excel">
                        <field name="sheet_name" placeholder="–±—é–¥–∂–µ—Ç –ë–î–∏–†"/>
                        <field name="start_row"/>
                    </group>
                </group>

                <!-- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–ª–æ–Ω–æ–∫ -->
                <group invisible="operation_type not in ['import', 'import_categories'] or context.get('show_result', False)">
                    <group string="–ú–∞–ø–ø—ñ–Ω–≥ –∫–æ–ª–æ–Ω–æ–∫ Excel">
                        <field name="code_column" placeholder="B"/>
                        <field name="name_column" placeholder="C"/>
                        <field name="amount_column" placeholder="G"/>
                    </group>
                    <group>
                        <div class="alert alert-warning">
                            <strong>üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Excel —Ñ–∞–π–ª—É:</strong><br/>
                            <strong>–ö–æ–ª–æ–Ω–∫–∞ B:</strong> –ö–æ–¥ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó (1.100., 2.300.1)<br/>
                            <strong>–ö–æ–ª–æ–Ω–∫–∞ C:</strong> –ù–∞–∑–≤–∞ —Å—Ç–∞—Ç—Ç—ñ –±—é–¥–∂–µ—Ç—É<br/>
                            <strong>–ö–æ–ª–æ–Ω–∫–∞ G:</strong> –ü–ª–∞–Ω–æ–≤–∞ —Å—É–º–∞<br/>
                            <br/>
                            <strong>üí° –ü—ñ–¥–∫–∞–∑–∫–∞:</strong> –ö–æ–¥–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π –º–∞—é—Ç—å —Ñ–æ—Ä–º–∞—Ç X.XXX. –∞–±–æ X.XXX.X
                        </div>
                    </group>
                </group>

                <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —ñ–º–ø–æ—Ä—Ç—É -->
                <group invisible="not context.get('show_result', False)">
                    <group string="–°—Ç–≤–æ—Ä–µ–Ω—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó" invisible="not created_categories">
                        <field name="created_categories" nolabel="1" readonly="1">
                            <tree>
                                <field name="code"/>
                                <field name="name"/>
                                <field name="parent_id"/>
                                <field name="active"/>
                            </tree>
                        </field>
                    </group>
                    <group string="–°—Ç–≤–æ—Ä–µ–Ω—ñ –ø–æ–∑–∏—Ü—ñ—ó –±—é–¥–∂–µ—Ç—É" invisible="not created_budget_lines">
                        <field name="created_budget_lines" nolabel="1" readonly="1">
                            <tree>
                                <field name="budget_category_id"/>
                                <field name="description"/>
                                <field name="planned_amount" sum="–í—Å—å–æ–≥–æ"/>
                            </tree>
                        </field>
                    </group>
                </group>

                <!-- –§–∞–π–ª –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è -->
                <group invisible="not context.get('show_result', False) or not result_file">
                    <group string="–†–µ–∑—É–ª—å—Ç—É—é—á–∏–π —Ñ–∞–π–ª">
                        <field name="result_file" widget="binary" filename="result_filename" readonly="1"/>
                        <field name="result_filename" invisible="1"/>
                    </group>
                </group>

                <footer>
                    <!-- –ö–Ω–æ–ø–∫–∏ –¥–ª—è –æ–ø–µ—Ä–∞—Ü—ñ–π -->
                    <div invisible="context.get('show_result', False)">
                        <button string="üì• –Ü–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏"
                                name="action_import_bdr"
                                type="object"
                                class="btn-primary"
                                invisible="operation_type not in ['import', 'import_categories']"/>

                        <button string="üì§ –ï–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏"
                                name="action_export_bdr"
                                type="object"
                                class="btn-primary"
                                invisible="operation_type != 'export'"/>

                        <button string="üìã –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —à–∞–±–ª–æ–Ω"
                                name="action_download_template"
                                type="object"
                                class="btn-secondary"/>
                    </div>

                    <!-- –ö–Ω–æ–ø–∫–∏ –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ -->
                    <div invisible="not context.get('show_result', False)">
                        <button string="üëÅÔ∏è –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó"
                                name="action_open_created_categories"
                                type="object"
                                class="btn-primary"
                                invisible="not created_categories"/>

                        <button string="üìä –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ø–æ–∑–∏—Ü—ñ—ó –±—é–¥–∂–µ—Ç—É"
                                name="action_open_created_budget_lines"
                                type="object"
                                class="btn-primary"
                                invisible="not created_budget_lines"/>

                        <button string="üîÑ –°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–∏–π"
                                name="%(action_bdr_budget_wizard_enhanced)d"
                                type="action"
                                class="btn-secondary"/>
                    </div>

                    <button string="‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏"
                            class="btn-default"
                            special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- Action –¥–ª—è –ø–æ–∫—Ä–∞—â–µ–Ω–æ–≥–æ –º–∞–π—Å—Ç—Ä–∞ -->
    <record id="action_bdr_budget_wizard_enhanced" model="ir.actions.act_window">
        <field name="name">üèóÔ∏è –ü–æ–∫—Ä–∞—â–µ–Ω–∏–π –ë–î–† –º–∞–π—Å—Ç–µ—Ä</field>
        <field name="res_model">bdr.budget.wizard.enhanced</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="view_id" ref="view_bdr_budget_wizard_enhanced_form"/>
    </record>

    <!-- –ú–µ–Ω—é –¥–ª—è –ø–æ–∫—Ä–∞—â–µ–Ω–æ–≥–æ –º–∞–π—Å—Ç—Ä–∞ -->
    <menuitem id="menu_bdr_budget_wizard_enhanced"
              name="üèóÔ∏è –ë–î–† –∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º–∏"
              parent="menu_budget_planning"
              action="action_bdr_budget_wizard_enhanced"
              sequence="25"/>

    <!-- –®–≤–∏–¥–∫—ñ –¥—ñ—ó -->
    <record id="action_bdr_import_with_categories" model="ir.actions.act_window">
        <field name="name">üì• –Ü–º–ø–æ—Ä—Ç –ë–î–† –∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º–∏</field>
        <field name="res_model">bdr.budget.wizard.enhanced</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{'default_operation_type': 'import', 'default_use_categories': True}</field>
    </record>

    <record id="action_bdr_import_categories_only" model="ir.actions.act_window">
        <field name="name">üìÇ –Ü–º–ø–æ—Ä—Ç —Ç—ñ–ª—å–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π –ë–î–†</field>
        <field name="res_model">bdr.budget.wizard.enhanced</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{'default_operation_type': 'import_categories', 'default_import_categories_only': True}</field>
    </record>

    <record id="action_bdr_export_with_categories" model="ir.actions.act_window">
        <field name="name">üì§ –ï–∫—Å–ø–æ—Ä—Ç –ë–î–† –∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º–∏</field>
        <field name="res_model">bdr.budget.wizard.enhanced</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{'default_operation_type': 'export'}</field>
    </record>

    <!-- –î–æ–¥–∞—Ç–∫–æ–≤—ñ –º–µ–Ω—é –≤ —Ä–æ–∑–¥—ñ–ª—ñ "–Ü–º–ø–æ—Ä—Ç/–ï–∫—Å–ø–æ—Ä—Ç" -->
    <menuitem id="menu_bdr_import_categories"
              name="üìÇ –Ü–º–ø–æ—Ä—Ç –∫–∞—Ç–µ–≥–æ—Ä—ñ–π"
              parent="menu_budget_import_export"
              action="action_bdr_import_categories_only"
              sequence="10"/>

    <menuitem id="menu_bdr_import_with_categories"
              name="üì• –Ü–º–ø–æ—Ä—Ç –ë–î–† –∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º–∏"
              parent="menu_budget_import_export"
              action="action_bdr_import_with_categories"
              sequence="15"/>

    <menuitem id="menu_bdr_export_with_categories"
              name="üì§ –ï–∫—Å–ø–æ—Ä—Ç –ë–î–† –∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º–∏"
              parent="menu_budget_import_export"
              action="action_bdr_export_with_categories"
              sequence="20"/>

    <!-- Server Action –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –¥–æ—Å—Ç—É–ø—É –∑ –ø–ª–∞–Ω—ñ–≤ –±—é–¥–∂–µ—Ç—É -->
    <record id="action_enhance_budget_with_categories" model="ir.actions.server">
        <field name="name">üèóÔ∏è –ü–æ–∫—Ä–∞—â–∏—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º–∏</field>
        <field name="model_id" ref="model_budget_plan"/>
        <field name="binding_model_id" ref="model_budget_plan"/>
        <field name="binding_view_types">list,form</field>
        <field name="state">code</field>
        <field name="code">
# –û—Ç—Ä–∏–º—É—î–º–æ –≤–∏–±—Ä–∞–Ω—ñ –∑–∞–ø–∏—Å–∏
if records:
    # –ë–µ—Ä–µ–º–æ –ø–µ—Ä—à–∏–π –∑–∞–ø–∏—Å –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
    record = records[0]
    action = {
        'type': 'ir.actions.act_window',
        'name': '–ü–æ–∫—Ä–∞—â–µ–Ω–∏–π –ë–î–† –º–∞–π—Å—Ç–µ—Ä',
        'res_model': 'bdr.budget.wizard.enhanced',
        'view_mode': 'form',
        'target': 'new',
        'context': {
            'default_operation_type': 'import',
            'default_period_id': record.period_id.id,
            'default_company_id': record.company_id.id,
            'default_cbo_id': record.cbo_id.id,
            'default_use_categories': True,
            'default_auto_create_categories': True
        }
    }
else:
    action = {
        'type': 'ir.actions.act_window',
        'name': '–ü–æ–∫—Ä–∞—â–µ–Ω–∏–π –ë–î–† –º–∞–π—Å—Ç–µ—Ä',
        'res_model': 'bdr.budget.wizard.enhanced',
        'view_mode': 'form',
        'target': 'new',
    }
        </field>
    </record>

    <!-- –î–æ–ø–æ–º—ñ–∂–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è -->
    <record id="view_bdr_wizard_help" model="ir.ui.view">
        <field name="name">bdr.wizard.help</field>
        <field name="model">bdr.budget.wizard.enhanced</field>
        <field name="arch" type="xml">
            <form string="–î–æ–≤—ñ–¥–∫–∞ –ø–æ —Ä–æ–±–æ—Ç—ñ –∑ –ë–î–†">
                <div class="alert alert-info">
                    <h4>üìñ –î–æ–≤—ñ–¥–∫–∞ –ø–æ –ø–æ–∫—Ä–∞—â–µ–Ω–æ–º—É –º–∞–π—Å—Ç—Ä—É –ë–î–†</h4>

                    <h5>üîß –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å:</h5>
                    <ul>
                        <li><strong>–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ–π:</strong> –°–∏—Å—Ç–µ–º–∞ —Å–∞–º–∞ —Å—Ç–≤–æ—Ä—é—î –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –Ω–∞ –æ—Å–Ω–æ–≤—ñ –∫–æ–¥—ñ–≤ –∑ Excel</li>
                        <li><strong>–Ü—î—Ä–∞—Ä—Ö—ñ—á–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:</strong> –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –±–∞–≥–∞—Ç–æ—Ä—ñ–≤–Ω–µ–≤–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä—ñ–π (1.100., 1.100.1)</li>
                        <li><strong>–ó–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—è —Ä–∞—Ö—É–Ω–∫—ñ–≤:</strong> –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –æ–±–ª—ñ–∫–æ–≤–∏—Ö —Ä–∞—Ö—É–Ω–∫—ñ–≤</li>
                        <li><strong>–ì–Ω—É—á–∫–∏–π —ñ–º–ø–æ—Ä—Ç:</strong> –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å —ñ–º–ø–æ—Ä—Ç—É —Ç—ñ–ª—å–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π –∞–±–æ –∑ –¥–∞–Ω–∏–º–∏</li>
                    </ul>

                    <h5>üìã –§–æ—Ä–º–∞—Ç Excel —Ñ–∞–π–ª—É:</h5>
                    <table class="table table-sm">
                        <thead>
                            <tr><th>–ö–æ–ª–æ–Ω–∫–∞</th><th>–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è</th><th>–ü—Ä–∏–∫–ª–∞–¥</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>B</td><td>–ö–æ–¥ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó</td><td>1.100., 2.300.1</td></tr>
                            <tr><td>C</td><td>–ù–∞–∑–≤–∞ —Å—Ç–∞—Ç—Ç—ñ</td><td>–î–æ—Ö—ñ–¥ –≤—ñ–¥ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó</td></tr>
                            <tr><td>G</td><td>–ü–ª–∞–Ω–æ–≤–∞ —Å—É–º–∞</td><td>1000000</td></tr>
                        </tbody>
                    </table>

                    <h5>üè∑Ô∏è –§–æ—Ä–º–∞—Ç –∫–æ–¥—ñ–≤ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π:</h5>
                    <ul>
                        <li><code>X.XXX.</code> - –æ—Å–Ω–æ–≤–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è (1.100.)</li>
                        <li><code>X.XXX.X</code> - –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—è (1.100.1)</li>
                        <li><code>X.XXX.X.X</code> - –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—è 3-–≥–æ —Ä—ñ–≤–Ω—è (1.100.1.1)</li>
                    </ul>

                    <h5>üí° –ü—Ä–∏–∫–ª–∞–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:</h5>
                    <div class="row">
                        <div class="col-6">
                            <strong>–î–æ—Ö–æ–¥–∏:</strong>
                            <ul>
                                <li>1.000. - –î–û–•–û–î–ò –í–°–¨–û–ì–û</li>
                                <li>1.100. - –î–æ—Ö—ñ–¥ –≤—ñ–¥ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó</li>
                                <li>1.200. - –Ü–Ω—à—ñ –¥–æ—Ö–æ–¥–∏</li>
                            </ul>
                        </div>
                        <div class="col-6">
                            <strong>–í–∏—Ç—Ä–∞—Ç–∏:</strong>
                            <ul>
                                <li>2.000. - –í–ò–¢–†–ê–¢–ò –ù–ê –í–ò–†–û–ë–ù–ò–¶–¢–í–û</li>
                                <li>2.100. - –°–∏—Ä–æ–≤–∏–Ω–∞ —Ç–∞ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏</li>
                                <li>2.200. - –ó–∞—Ä–æ–±—ñ—Ç–Ω–∞ –ø–ª–∞—Ç–∞</li>
                            </ul>
                        </div>
                    </div>

                    <h5>‚öôÔ∏è –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:</h5>
                    <ol>
                        <li>–°–ø–æ—á–∞—Ç–∫—É —ñ–º–ø–æ—Ä—Ç—É–π—Ç–µ —Ç—ñ–ª—å–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏</li>
                        <li>–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è —â–æ –∫–æ–¥–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π —É–Ω—ñ–∫–∞–ª—å–Ω—ñ</li>
                        <li>–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –ª–æ–≥—ñ—á–Ω—É –Ω—É–º–µ—Ä–∞—Ü—ñ—é (1.xxx - –¥–æ—Ö–æ–¥–∏, 2.xxx - –≤–∏—Ç—Ä–∞—Ç–∏)</li>
                        <li>–ü—ñ—Å–ª—è —ñ–º–ø–æ—Ä—Ç—É –Ω–∞–ª–∞—à—Ç—É–π—Ç–µ –∑–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –∑ –æ–±–ª—ñ–∫–æ–≤–∏–º–∏ —Ä–∞—Ö—É–Ω–∫–∞–º–∏</li>
                    </ol>
                </div>
            </form>
        </field>
    </record>

</odoo>