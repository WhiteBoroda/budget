<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±—é–¥–∂–µ—Ç–∞–º–∏ -->

    <!-- –ù–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è Odoo 17 -->
    <record id="action_budget_quick_create" model="ir.actions.act_window">
        <field name="name">–®–≤–∏–¥–∫–µ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –±—é–¥–∂–µ—Ç—É</field>
        <field name="res_model">budget.plan</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{
            'default_state': 'draft',
            'form_view_initial_mode': 'edit',
            'quick_create': True
        }</field>
    </record>

    <!-- –î–µ–π—Å—Ç–≤–∏–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –±—é–¥–∂–µ—Ç–æ–≤ -->
    <record id="action_budget_overdue" model="ir.actions.act_window">
        <field name="name">–ü—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω—ñ –±—é–¥–∂–µ—Ç–∏</field>
        <field name="res_model">budget.plan</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[
            ('submission_deadline', '&lt;', context_today().strftime('%Y-%m-%d')),
            ('state', '!=', 'approved')
        ]</field>
        <field name="context">{
            'search_default_group_by_cbo': 1
        }</field>
    </record>

    <!-- –î–µ–π—Å—Ç–≤–∏–µ –¥–ª—è –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
    <record id="action_budget_dashboard" model="ir.actions.act_window">
        <field name="name">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –±—é–¥–∂–µ—Ç–∞–º–∏</field>
        <field name="res_model">budget.dashboard</field>
        <field name="view_mode">kanban,form</field>
        <field name="target">current</field>
        <field name="context">{
            'dashboard_mode': True
        }</field>
    </record>

    <!-- Dashboard Kanban View -->
    <record id="view_budget_dashboard_kanban" model="ir.ui.view">
        <field name="name">budget.dashboard.kanban</field>
        <field name="model">budget.dashboard</field>
        <field name="arch" type="xml">
            <kanban class="o_budget_dashboard_kanban" create="false" edit="false">
                <field name="period_id"/>
                <field name="total_budgets"/>
                <field name="approved_budgets"/>
                <field name="pending_budgets"/>
                <field name="overdue_budgets"/>
                <field name="total_planned"/>
                <field name="total_actual"/>
                <templates>
                    <t t-name="kanban-box">
                        <div class="budget-dashboard">
                            <div class="dashboard-header">
                                <h1>üìä –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –±—é–¥–∂–µ—Ç–∞–º–∏</h1>
                                <div class="subtitle">
                                    –ü–µ—Ä—ñ–æ–¥: <t t-esc="record.period_id.value"/>
                                </div>
                            </div>

                            <div class="budget-stats-grid">
                                <!-- –ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –±—é–¥–∂–µ—Ç—ñ–≤ -->
                                <div class="budget-stat-card total">
                                    <div class="stat-icon">üìã</div>
                                    <div class="stat-number">
                                        <t t-esc="record.total_budgets.value"/>
                                    </div>
                                    <div class="stat-label">–í—Å—å–æ–≥–æ –±—é–¥–∂–µ—Ç—ñ–≤</div>
                                </div>

                                <!-- –ó–∞—Ç–≤–µ—Ä–¥–∂–µ–Ω—ñ –±—é–¥–∂–µ—Ç–∏ -->
                                <div class="budget-stat-card approved">
                                    <div class="stat-icon">‚úÖ</div>
                                    <div class="stat-number">
                                        <t t-esc="record.approved_budgets.value"/>
                                    </div>
                                    <div class="stat-label">–ó–∞—Ç–≤–µ—Ä–¥–∂–µ–Ω—ñ</div>
                                </div>

                                <!-- –û—á—ñ–∫—É—é—Ç—å –∑–∞—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è -->
                                <div class="budget-stat-card pending">
                                    <div class="stat-icon">‚è≥</div>
                                    <div class="stat-number">
                                        <t t-esc="record.pending_budgets.value"/>
                                    </div>
                                    <div class="stat-label">–û—á—ñ–∫—É—é—Ç—å</div>
                                </div>

                                <!-- –ü—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω—ñ -->
                                <div class="budget-stat-card overdue">
                                    <div class="stat-icon">‚ö†Ô∏è</div>
                                    <div class="stat-number">
                                        <t t-esc="record.overdue_budgets.value"/>
                                    </div>
                                    <div class="stat-label">–ü—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω—ñ</div>
                                </div>
                            </div>

                            <!-- –§—ñ–Ω–∞–Ω—Å–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è -->
                            <div class="row mt-3">
                                <div class="col-6">
                                    <div class="text-center">
                                        <h4>üí∞ –ü–ª–∞–Ω–æ–≤–∞ —Å—É–º–∞</h4>
                                        <h3>
                                            <t t-esc="record.total_planned.value"/> –≥—Ä–Ω
                                        </h3>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="text-center">
                                        <h4>üìà –§–∞–∫—Ç–∏—á–Ω–∞ —Å—É–º–∞</h4>
                                        <h3>
                                            <t t-esc="record.total_actual.value"/> –≥—Ä–Ω
                                        </h3>
                                    </div>
                                </div>
                            </div>

                            <!-- –î—ñ—ó -->
                            <div class="budget-action-buttons">
                                <button type="object"
                                        name="action_view_all_budgets"
                                        class="budget-btn primary">
                                    üìã –í—Å—ñ –±—é–¥–∂–µ—Ç–∏
                                </button>
                                <button type="object"
                                        name="action_quick_create_budget"
                                        class="budget-btn success">
                                    ‚ûï –°—Ç–≤–æ—Ä–∏—Ç–∏ –±—é–¥–∂–µ—Ç
                                </button>
                                <button type="object"
                                        name="action_view_overdue"
                                        class="budget-btn warning"
                                        invisible="overdue_budgets == 0">
                                    ‚ö†Ô∏è –ü—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω—ñ
                                </button>
                                <button type="object"
                                        name="action_analytics"
                                        class="budget-btn primary">
                                    üìä –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞
                                </button>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Dashboard Form View -->
    <record id="view_budget_dashboard_form" model="ir.ui.view">
        <field name="name">budget.dashboard.form</field>
        <field name="model">budget.dashboard</field>
        <field name="arch" type="xml">
            <form create="false" edit="false">
                <sheet>
                    <div class="oe_title">
                        <h1>üìä –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –±—é–¥–∂–µ—Ç–∞–º–∏</h1>
                    </div>

                    <group>
                        <group string="–ü–µ—Ä—ñ–æ–¥">
                            <field name="period_id" options="{'no_create': True}"/>
                            <field name="company_id" options="{'no_create': True}"/>
                        </group>
                        <group string="–ó–∞–≥–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞">
                            <field name="total_budgets"/>
                            <field name="approved_budgets"/>
                            <field name="pending_budgets"/>
                            <field name="overdue_budgets"/>
                        </group>
                    </group>

                    <group>
                        <group string="–§—ñ–Ω–∞–Ω—Å–æ–≤—ñ –ø–æ–∫–∞–∑–Ω–∏–∫–∏">
                            <field name="total_planned" widget="monetary"/>
                            <field name="total_actual" widget="monetary"/>
                            <field name="execution_percent" widget="percentage"/>
                        </group>
                        <group string="–í—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è">
                            <field name="variance_amount" widget="monetary"/>
                            <field name="variance_percent" widget="percentage"/>
                        </group>
                    </group>

                    <notebook>
                        <page string="–®–≤–∏–¥–∫—ñ –¥—ñ—ó">
                            <div class="row">
                                <div class="col-12">
                                    <div class="quick-forecast-widget">
                                        <h3>üöÄ –®–≤–∏–¥–∫—ñ –¥—ñ—ó</h3>
                                        <div class="budget-action-buttons">
                                            <button name="action_view_all_budgets"
                                                    type="object"
                                                    class="budget-btn primary">
                                                üìã –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤—Å—ñ –±—é–¥–∂–µ—Ç–∏
                                            </button>
                                            <button name="action_quick_create_budget"
                                                    type="object"
                                                    class="budget-btn success">
                                                ‚ûï –°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–∏–π –±—é–¥–∂–µ—Ç
                                            </button>
                                            <button name="action_view_overdue"
                                                    type="object"
                                                    class="budget-btn warning"
                                                    invisible="overdue_budgets == 0">
                                                ‚ö†Ô∏è –ü—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω—ñ –±—é–¥–∂–µ—Ç–∏ (<field name="overdue_budgets"/>)
                                            </button>
                                            <button name="action_analytics"
                                                    type="object"
                                                    class="budget-btn primary">
                                                üìä –î–µ—Ç–∞–ª—å–Ω–∞ –∞–Ω–∞–ª—ñ—Ç–∏–∫–∞
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </page>

                        <page string="–ê–Ω–∞–ª—ñ—Ç–∏–∫–∞">
                            <div class="row">
                                <div class="col-12">
                                    <!-- –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫—É -->
                                    <div class="alert alert-info">
                                        <h4>üìà –ê–Ω–∞–ª—ñ—Ç–∏—á–Ω—ñ –¥–∞–Ω—ñ</h4>
                                        <p>–î–µ—Ç–∞–ª—å–Ω—É –∞–Ω–∞–ª—ñ—Ç–∏–∫—É –º–æ–∂–Ω–∞ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤ —Ä–æ–∑–¥—ñ–ª—ñ "–ê–Ω–∞–ª—ñ–∑ –±—é–¥–∂–µ—Ç—ñ–≤"</p>
                                    </div>
                                </div>
                            </div>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- –ú–µ–Ω—é –¥–ª—è –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
    <menuitem id="menu_budget_dashboard"
              name="üìä –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è"
              parent="menu_budget_main"
              action="action_budget_dashboard"
              sequence="5"/>

</odoo>